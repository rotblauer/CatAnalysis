---
title: "cats"
author: "JL"
date: "9/23/2017"
output: 
  html_document: 
    keep_md: yes
---

```{r setup, include=FALSE,eval=FALSE}
library(jsonlite)


system.time(x <- fromJSON("~/Go/src/github.com/rotblauer/tileTester2/out.json"))
loc=data.frame()
loc = do.call(rbind.data.frame, x$features$geometry$coordinates)
loc$elevation =x$features$properties$Elevation
colnames(loc) =c("lon","lat","elevation")
save(loc,file = "loc.RData")
```

```{r p,warning=FALSE,echo=FALSE}
library(knitr)
library(rgl)
library(rglwidget)
knit_hooks$set(webgl = hook_webgl)
library(scatterplot3d)
library(MASS)
library(dplyr)
library(ggplot2)
library(akima)
theme_set(theme_bw(20))
t2 <- theme(
    axis.line = element_line(colour = "black"),
    axis.text = element_text(colour = "black"),
    axis.ticks = element_line(colour = "black"),
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.border = element_blank(),
    panel.background = element_blank(),
    axis.text.x=element_text(angle=90,hjust=1)
)

load("loc.RData")

0.0025
loc_gc <- filter(loc, lat < 38.6490 & lat > 38.6465) %>% filter(elevation>100&lon > -90.2775& lon < -90.275)
loc_gc =loc_gc[complete.cases(loc_gc), ]
loc_gc= loc_gc[!duplicated(loc_gc),]
z <- kde2d(loc_gc$lat, loc_gc$lon)

ggplot(loc_gc, aes(x = lon, y = lat,colour=elevation)) + geom_point()+ geom_density_2d()+t2
ggplot(loc_gc, aes(x = lon, y = elevation,colour=elevation)) + geom_point()+ geom_density_2d()+t2
ggplot(loc_gc, aes(x = lat, y = elevation,colour=elevation)) + geom_point()+ geom_density_2d()+t2

 ggplot(loc_gc, aes(x = lon, y = lat))+stat_density2d(aes(fill=..density..), geom="raster", contour=FALSE) +
  scale_fill_gradient2(low="blue", mid="white", high="black") +t2
 
 # scatterplot3d(loc_gc, pch = 16,
 #              grid=TRUE, box=FALSE)
 

 n_interpolation <- 70
# https://stackoverflow.com/questions/36413652/3d-surface-interpolation
spline_interpolated <- interp(loc_gc$lon, loc_gc$lat, loc_gc$elevation,
                              xo=seq(min(loc_gc$lon), max(loc_gc$lon), length = n_interpolation),
                              yo=seq(min(loc_gc$lat), max(loc_gc$lat), length = n_interpolation),
                              linear = FALSE, extrap = FALSE,duplicate = "median")

x.si <- spline_interpolated$x
y.si <- spline_interpolated$y
z.si <- spline_interpolated$z

# zlim <- range(y.si)
# zlen <- zlim[2] - zlim[1] + 1
# # 
#  colorlut <- terrain.colors(zlen)
#  col <- colorlut[ z.si - zlim[1] + 1 ] # assign colors to heights for each point


library(mgcv)
library(deldir)
mod <- gam(elevation ~ te(lon, lat), data = loc_gc)

zfit <- fitted(mod)
col <- cm.colors(20)[1 + 
         round(19*(zfit - min(zfit))/diff(range(zfit)))]

persp3d(deldir(loc_gc$lon, loc_gc$lat, z = zfit))

mfrow3d(nr = 2, nc = 2)
# plot3d(loc_gc$lon, loc_gc$lat, loc_gc$elevation)
persp3d(x.si, y.si, z.si, col = "blue")

rglwidget(height = 1000, width = 1000)



```

